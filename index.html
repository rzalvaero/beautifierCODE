<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Beautifier</title>
    <!-- highlight.js CSS (Dark Theme: Atom One Dark) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <!-- Google Fonts for Icons (Material Icons) - for toolbar icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        /* Custom font for a clean look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #282c34; /* Dark background */
            color: #abb2bf; /* Light text color */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            width: 100%;
            max-width: 900px; /* Adjusted max-width to match image better */
            background-color: #21252b; /* Slightly lighter dark background for container */
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            padding: 30px;
            box-sizing: border-box;
        }

        h1 {
            font-size: 2.8rem;
            font-weight: 700;
            color: #e0e0e0;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #9da5b4;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 2rem;
            justify-content: center;
        }

        .tag {
            background-color: #4a4f59;
            color: #e0e0e0;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: default;
        }

        /* Specific tag colors (as seen in image) */
        .tag.blue { background-color: #5d9cec; color: #fff; }
        .tag.red { background-color: #ed5565; color: #fff; }
        .tag.green { background-color: #8cc152; color: #fff; }
        .tag.purple { background-color: #967adc; color: #fff; }
        .tag.orange { background-color: #ff9800; color: #fff; }
        .tag.grey { background-color: #607d8b; color: #fff; }
        .tag.pink { background-color: #ec407a; color: #fff; }
        .tag.teal { background-color: #26a69a; color: #fff; }

        .controls-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 1.5rem;
            background-color: #282c34;
            padding: 15px 20px;
            border-radius: 8px;
        }

        .select-language-wrapper {
            flex-grow: 1;
            min-width: 200px;
        }

        .select-language {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #4a4f59;
            border-radius: 5px;
            background-color: #3e4451;
            color: #abb2bf;
            font-size: 1rem;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%23abb2bf" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px;
            cursor: pointer;
        }

        .select-language option {
            background-color: #3e4451;
            color: #abb2bf;
        }

        .toggle-switch {
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
        }
        .toggle-switch input[type="checkbox"] {
            height: 0;
            width: 0;
            visibility: hidden;
        }
        .toggle-switch label {
            cursor: pointer;
            text-indent: -9999px;
            width: 45px;
            height: 25px;
            background: #555;
            display: block;
            border-radius: 100px;
            position: relative;
        }
        .toggle-switch label:after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background: #fff;
            border-radius: 90px;
            transition: 0.3s;
        }
        .toggle-switch input:checked + label {
            background: #66bb6a;
        }
        .toggle-switch input:checked + label:after {
            left: calc(100% - 2px);
            transform: translateX(-100%);
        }
        .toggle-switch label:active:after {
            width: 30px;
        }

        .indent-control {
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        .indent-button {
            background-color: #4a4f59;
            color: #e0e0e0;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s;
        }
        .indent-button:hover {
            background-color: #5a606b;
        }
        .indent-value {
            font-size: 1rem;
            min-width: 20px;
            text-align: center;
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            background-color: #282c34;
            padding: 10px 15px;
            border-radius: 8px;
            justify-content: flex-start;
        }

        .toolbar-button {
            background-color: #3e4451;
            color: #abb2bf;
            border: none;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .toolbar-button:hover {
            background-color: #4a4f59;
        }
        .toolbar-button i.material-icons {
            font-size: 1.2rem;
        }
        .toolbar-button span {
            margin-left: 5px;
            font-size: 0.9rem;
        }

        /* Editor Layout - Split View */
        .code-editor-wrapper {
            display: flex;
            background-color: #282c34;
            border-radius: 8px;
            overflow: hidden;
            min-height: 400px;
            max-height: 600px;
            resize: vertical;
            border: 1px solid #3e4451;
        }

        .editor-pane {
            display: flex;
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .editor-pane:first-child {
            border-right: 1px solid #3e4451;
        }

        .line-numbers {
            background-color: #21252b;
            color: #636d83;
            padding: 15px 10px; /* Consistent padding with code areas */
            text-align: right;
            font-family: 'Fira Code', 'Cascadia Code', 'Consolas', monospace;
            font-size: 0.9rem;
            line-height: 1.5; /* Consistent line height */
            user-select: none;
            flex-shrink: 0;
            overflow-y: hidden;
            width: 40px;
        }
        .line-numbers span {
            display: block;
            padding: 0; /* Ensure no extra padding on individual line number spans */
            margin: 0; /* Ensure no extra margin on individual line number spans */
            line-height: inherit; /* Inherit line-height from parent .line-numbers */
        }

        textarea#inputCode,
        .code-output-area {
            flex-grow: 1;
            background-color: transparent;
            color: #abb2bf;
            border: none;
            padding: 15px; /* Consistent padding with line numbers */
            font-family: 'Fira Code', 'Cascadia Code', 'Consolas', monospace;
            font-size: 0.9rem;
            line-height: 1.5; /* Consistent line height */
            outline: none;
            resize: none;
            box-sizing: border-box;
            white-space: pre;
            overflow: auto;
        }

        .code-output-area pre,
        .code-output-area pre code.hljs { /* Target pre and highlight.js's code output */
            margin: 0 !important; /* Aggressively remove margin */
            padding: 0 !important; /* Aggressively remove padding */
            display: block; /* Ensure it takes full block space */
            box-sizing: border-box;
            line-height: inherit; /* Inherit line-height from parent .code-output-area */
        }

        /* Copy message style */
        #copyMessage {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            pointer-events: none;
            z-index: 1000;
            font-size: 1rem;
        }
        #copyMessage.show {
            opacity: 1;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .code-editor-wrapper {
                flex-direction: column;
                min-height: 600px;
            }
            .editor-pane {
                flex: none;
                width: 100%;
                min-height: 300px;
            }
            .editor-pane:first-child {
                border-right: none;
                border-bottom: 1px solid #3e4451;
            }
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            h1 {
                font-size: 2rem;
            }
            .subtitle {
                font-size: 1rem;
            }
            .controls-row {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }
            .select-language-wrapper {
                min-width: unset;
                width: 100%;
            }
            .indent-control, .toggle-switch {
                width: 100%;
                justify-content: center;
            }
            .toolbar {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="center-align">Code Beautifier</h1>
        <p class="subtitle center-align">
            Beautify and format code using conventions, with support for many popular languages.
        </p>

        <div class="tags-container">
            <span class="tag blue">beautify code</span>
            <span class="tag red">c</span>
            <span class="tag green">c#</span>
            <span class="tag purple">c++</span>
            <span class="tag orange">css</span>
            <span class="tag grey">go</span>
            <span class="tag blue">html</span>
            <span class="tag pink">java</span>
            <span class="tag teal">javascript</span>
            <span class="tag blue">perl</span>
            <span class="tag red">php</span>
            <span class="tag green">python</span>
            <span class="tag purple">ruby</span>
            <span class="tag orange">sql</span>
            <span class="tag grey">typescript</span>
            <span class="tag blue">xml</span>
            <span class="tag red">less</span>
            <span class="tag green">scss</span>
        </div>

        <div class="controls-row">
            <div class="select-language-wrapper">
                <select id="languageSelect" class="select-language">
                    <option value="html" selected>HTML</option>
                    <option value="xml">XML</option>
                    <option value="css">CSS</option>
                    <option value="javascript">JavaScript</option>
                    <option value="php">PHP</option>
                    <option value="c">C</option>
                    <option value="csharp">C#</option>
                    <option value="cpp">C++</option>
                    <option value="go">Go</option>
                    <option value="java">Java</option>
                    <option value="python">Python</option>
                    <option value="ruby">Ruby</option>
                    <option value="sql">SQL</option>
                    <option value="typescript">TypeScript</option>
                    <option value="less">Less</option>
                    <option value="scss">SCSS</option>
                    <option value="mikrotik">Kode Mikrotik</option>
                </select>
            </div>

            <div class="toggle-switch">
                <input type="checkbox" id="sampleToggle" checked>
                <label for="sampleToggle"></label>
                <span>Sample</span>
            </div>

            <div class="indent-control">
                <span>Indent</span>
                <button id="indentDecrease" class="indent-button">-</button>
                <span id="indentValue" class="indent-value">4</span>
                <button id="indentIncrease" class="indent-button">+</button>
            </div>
        </div>

        <div class="toolbar">
            <button class="toolbar-button" id="searchButton"><i class="material-icons">search</i></button>
            <button class="toolbar-button" id="refreshButton"><i class="material-icons">refresh</i></button>
            <button class="toolbar-button" id="downloadButton"><i class="material-icons">download</i></button>
            <button class="toolbar-button" id="wrapButton"><i class="material-icons">wrap_text</i></button>
            <button class="toolbar-button" id="copyButton"><i class="material-icons">content_copy</i></button>
            <button class="toolbar-button" id="beautifyCodeButton"><i class="material-icons">auto_fix_high</i></button> <!-- New Beautify button -->
        </div>

        <div class="code-editor-wrapper" id="codeEditorWrapper">
            <!-- Input Pane -->
            <div class="editor-pane">
                <div class="line-numbers" id="inputLineNumbers"></div>
                <textarea id="inputCode" spellcheck="false" autocorrect="off" autocapitalize="off" placeholder="Masukkan kode di sini..."></textarea>
            </div>
            <!-- Output Pane -->
            <div class="editor-pane">
                <div class="line-numbers" id="outputLineNumbers"></div>
                <div class="code-output-area" id="outputCodeContainer">
                    <pre><code id="outputCode" class="language-plaintext"></code></pre>
                </div>
            </div>
        </div>

        <div id="copyMessage">Disalin!</div>
    </div>

    <!-- highlight.js library and language definitions -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/xml.min.js"></script> <!-- for HTML, XML, SVG -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/c.min.js"></script> <!-- for C, C++, Objective-C -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/csharp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/ruby.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/less.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/scss.min.js"></script>
    <!-- Add more highlight.js language definitions as needed for your supported languages -->

    <script>
        const inputCode = document.getElementById('inputCode');
        const outputCodeElement = document.getElementById('outputCode');
        const languageSelect = document.getElementById('languageSelect');
        const indentValueElement = document.getElementById('indentValue');
        const indentDecreaseButton = document.getElementById('indentDecrease');
        const indentIncreaseButton = document.getElementById('indentIncrease');
        const sampleToggle = document.getElementById('sampleToggle');
        const inputLineNumbersElement = document.getElementById('inputLineNumbers');
        const outputLineNumbersElement = document.getElementById('outputLineNumbers');
        const outputCodeContainer = document.getElementById('outputCodeContainer');
        const copyButton = document.getElementById('copyButton');
        const beautifyCodeButton = document.getElementById('beautifyCodeButton'); // New button reference
        const copyMessageElement = document.getElementById('copyMessage');
        const refreshButton = document.getElementById('refreshButton');
        const downloadButton = document.getElementById('downloadButton');
        const wrapButton = document.getElementById('wrapButton');
        const searchButton = document.getElementById('searchButton');

        let currentIndentSize = 4;
        let isWordWrapEnabled = false;

        const sampleCodes = {
            html: `<!DOCTYPE html>
<html>
<head>
    <title>Sample HTML</title>
</head>
<body>
    <h1>Hello, World!</h1>
    <p>This is a <b>sample</b> HTML code.</p>
    <!-- A comment -->
    <img src="image.jpg" alt="Sample Image"/>
</body>
</html>`,
            xml: `<?xml version="1.0" encoding="UTF-8"?>
<bookstore>
  <book category="cooking">
    <title lang="en">Everyday Italian</title>
    <author>Giada De Laurentiis</author>
    <year>2005</year>
    <price>30.00</price>
  </book>
  <book category="children">
    <title lang="en">Harry Potter</title>
    <author>J. K. Rowling</author>
    <year>2005</year>
    <price>29.99</price>
  </book>
</bookstore>`,
            css: `body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background-color: #f4f4f4;
}

.container {
    width: 80%;
    margin: auto;
    overflow: hidden;
    background-color: #fff;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}`,
            javascript: `function greet(name) {
    console.log("Hello, " + name + "!");
    if (name === "World") {
        return "Welcome!";
    } else {
        const message = "Nice to meet you.";
        return message;
    }
}

// Call the function
greet("Alice");`,
            php: `<?php

function calculateSum($a, $b) {
    $sum = $a + $b;
    return $sum;
}

$num1 = 10;
$num2 = 20;
$result = calculateSum($num1, $num2);

echo "The sum is: " . $result;

?>`,
            c: `#include <stdio.h>

int main() {
    // Print "Hello, World!" to the console
    printf("Hello, World!\\n");
    return 0;
}`,
            csharp: `using System;

public class HelloWorld
{
    public static void Main(string[] args)
    {
        Console.WriteLine("Hello, World!");
    }
}`,
            cpp: `#include <iostream>

int main() {
    std::cout << "Hello, World!" << std::endl;
    return 0;
}`,
            go: `package main

import "fmt"

func main() {
    fmt.Println("Hello, World!")
}`,
            java: `public class HelloWorld {
    public static void main(String[] args) {
        System.out.println("Hello, World!");
    }
}`,
            python: `def greet(name):
    print(f"Hello, {name}!")

if __name__ == "__main__":
    greet("World")`,
            ruby: `def greet(name)
  puts "Hello, #{name}!"
end

greet("World")`,
            sql: `SELECT
    CustomerID,
    FirstName,
    LastName,
    Email
FROM
    Customers
WHERE
    Country = 'USA' AND IsActive = TRUE
ORDER BY
    LastName, FirstName;`,
            typescript: `function greet(name: string): string {
    console.log("Hello, " + name + "!");
    return "Welcome!";
}

const user: string = "TypeScript User";
greet(user);`,
            less: `@primary-color: #337ab7;
@text-color: #333;

.header {
  background-color: @primary-color;
  color: #fff;
  padding: 20px;

  h1 {
    font-size: 2em;
    margin: 0;
  }
}`,
            scss: `$primary-color: #337ab7;
$text-color: #333;

.header {
  background-color: $primary-color;
  color: #fff;
  padding: 20px;

  h1 {
    font-size: 2em;
    margin: 0;
  }
}`,
            mikrotik: `# Mikrotik Sample Script
/ip firewall nat
add action=masquerade chain=srcnat out-interface=ether1
/ip address
add address=192.168.88.1/24 interface=bridge
/system identity set name="MyRouter"
/user add name=admin password=secure group=full`,
        };

        // Function to update line numbers for a given text and line number element
        function updateLineNumbers(text, lineNumbersElement) {
            // Split by newline characters to count all lines, including empty ones
            const lines = text.split('\n').length;
            let lineNumbersHtml = '';
            for (let i = 1; i <= lines; i++) {
                lineNumbersHtml += `<span>${i}</span>\n`;
            }
            lineNumbersElement.innerHTML = lineNumbersHtml;
        }

        // Sync scroll position between input textarea and its line numbers
        inputCode.addEventListener('scroll', () => {
            inputLineNumbersElement.scrollTop = inputCode.scrollTop;
        });

        // Sync scroll position between output code area and its line numbers
        outputCodeContainer.addEventListener('scroll', () => {
            outputLineNumbersElement.scrollTop = outputCodeContainer.scrollTop;
        });


        // Event Listeners
        languageSelect.addEventListener('change', () => {
            if (sampleToggle.checked) {
                inputCode.value = sampleCodes[languageSelect.value] || '';
            }
            beautifyCode(); // Always beautify on language change or sample toggle
        });

        inputCode.addEventListener('input', beautifyCode);
        inputCode.addEventListener('input', () => updateLineNumbers(inputCode.value, inputLineNumbersElement));

        indentDecreaseButton.addEventListener('click', () => {
            if (currentIndentSize > 1) {
                currentIndentSize--;
                indentValueElement.textContent = currentIndentSize;
                beautifyCode();
            }
        });

        indentIncreaseButton.addEventListener('click', () => {
            currentIndentSize++;
            indentValueElement.textContent = currentIndentSize;
            beautifyCode();
        });

        sampleToggle.addEventListener('change', () => {
            if (sampleToggle.checked) {
                inputCode.value = sampleCodes[languageSelect.value] || '';
            } else {
                inputCode.value = '';
            }
            beautifyCode(); // Beautify when sample is toggled off (to clear output)
        });

        copyButton.addEventListener('click', copyToClipboard);
        beautifyCodeButton.addEventListener('click', beautifyCode); // Event listener for Beautify button

        refreshButton.addEventListener('click', () => {
            inputCode.value = '';
            beautifyCode(); // Clear input, then beautify to clear output and reset line numbers
        });

        downloadButton.addEventListener('click', downloadCode);

        wrapButton.addEventListener('click', () => {
            isWordWrapEnabled = !isWordWrapEnabled;
            const wrapStyle = isWordWrapEnabled ? 'pre-wrap' : 'pre';
            inputCode.style.whiteSpace = wrapStyle;
            outputCodeElement.style.whiteSpace = wrapStyle;
            wrapButton.style.backgroundColor = isWordWrapEnabled ? '#66bb6a' : '#3e4451'; // Highlight if active
        });

        // Search Functionality
        searchButton.addEventListener('click', () => {
            const searchTerm = prompt("Masukkan teks yang ingin dicari:");
            if (searchTerm === null || searchTerm.trim() === "") {
                return; // User cancelled or entered empty string
            }

            const text = inputCode.value;
            let startIndex = inputCode.selectionEnd; // Start search from current cursor position

            // If nothing is selected, or cursor is at the end, try from beginning
            if (startIndex === text.length) {
                startIndex = 0;
            }

            let foundIndex = text.indexOf(searchTerm, startIndex);

            // If not found from current position, try from the beginning
            if (foundIndex === -1 && startIndex !== 0) {
                foundIndex = text.indexOf(searchTerm, 0);
            }

            if (foundIndex !== -1) {
                inputCode.focus();
                inputCode.setSelectionRange(foundIndex, foundIndex + searchTerm.length);
                // Scroll to the found text if it's out of view - basic implementation
                const lineHeight = parseFloat(getComputedStyle(inputCode).lineHeight);
                const charWidth = parseFloat(getComputedStyle(inputCode).fontSize) * 0.6; // Approximation
                inputCode.scrollTop = (Math.floor(foundIndex / (inputCode.cols || 80))) * lineHeight; // Rough scroll
                showCopyMessage(`Ditemukan: "${searchTerm}"`, true);
            } else {
                showCopyMessage(`Teks "${searchTerm}" tidak ditemukan.`, false);
            }
        });


        function beautifyCode() {
            const code = inputCode.value;
            const language = languageSelect.value;

            if (!code.trim()) {
                outputCodeElement.textContent = "Kode akan muncul di sini setelah dirapikan.";
                outputCodeElement.className = '';
                outputCodeElement.classList.add('language-plaintext');
                updateLineNumbers("", inputLineNumbersElement);
                updateLineNumbers("", outputLineNumbersElement);
                return;
            }

            let formattedCode = '';
            let hljsLanguageId = ''; // To store the highlight.js specific language ID

            switch (language) {
                case 'html':
                case 'xml':
                    formattedCode = beautifyHtml(code, currentIndentSize);
                    hljsLanguageId = 'xml';
                    break;
                case 'css':
                    formattedCode = beautifyCss(code, currentIndentSize);
                    hljsLanguageId = 'css';
                    break;
                case 'javascript':
                    formattedCode = beautifyJavaScript(code, currentIndentSize);
                    hljsLanguageId = 'javascript';
                    break;
                case 'php':
                    formattedCode = code;
                    hljsLanguageId = 'php';
                    break;
                case 'c':
                    formattedCode = code;
                    hljsLanguageId = 'c';
                    break;
                case 'csharp':
                    formattedCode = code;
                    hljsLanguageId = 'csharp';
                    break;
                case 'cpp':
                    formattedCode = code;
                    hljsLanguageId = 'cpp';
                    break;
                case 'go':
                    formattedCode = code;
                    hljsLanguageId = 'go';
                    break;
                case 'java':
                    formattedCode = code;
                    hljsLanguageId = 'java';
                    break;
                case 'python':
                    formattedCode = code;
                    hljsLanguageId = 'python';
                    break;
                case 'ruby':
                    formattedCode = code;
                    hljsLanguageId = 'ruby';
                    break;
                case 'sql':
                    formattedCode = code;
                    hljsLanguageId = 'sql';
                    break;
                case 'typescript':
                    formattedCode = code;
                    hljsLanguageId = 'typescript';
                    break;
                case 'less':
                    formattedCode = code;
                    hljsLanguageId = 'less';
                    break;
                case 'scss':
                    formattedCode = code;
                    hljsLanguageId = 'scss';
                    break;
                case 'mikrotik':
                    // Mikrotik is not directly supported by highlight.js, fallback to plaintext
                    formattedCode = `Beautifikasi Kode Mikrotik sangat spesifik dan memerlukan parser khusus. Ini adalah output dasar:\n${code}`;
                    hljsLanguageId = 'plaintext';
                    break;
                default: // Fallback for any unhandled language
                    formattedCode = code;
                    hljsLanguageId = 'plaintext';
            }

            // Set the content for highlight.js to process
            outputCodeElement.textContent = formattedCode; // Use textContent to set raw code

            // Apply highlighting
            try {
                if (hljs.getLanguage(hljsLanguageId)) {
                    // If highlight.js supports the language, use highlight()
                    outputCodeElement.innerHTML = hljs.highlight(formattedCode, { language: hljsLanguageId }).value;
                    outputCodeElement.classList.remove('language-plaintext'); // Remove fallback class if successful
                } else {
                    // If highlight.js doesn't support, just display as plain text
                    outputCodeElement.textContent = formattedCode;
                    outputCodeElement.classList.add('language-plaintext'); // Add fallback class
                }
            } catch (e) {
                console.error("Highlighting error for language", hljsLanguageId, e);
                // Fallback to plain text if an error occurs during highlighting
                outputCodeElement.textContent = formattedCode;
                outputCodeElement.classList.add('language-plaintext');
            }


            // Update line numbers for both input and output
            updateLineNumbers(inputCode.value, inputLineNumbersElement);
            // Pass formattedCode directly to updateLineNumbers, as it's what's displayed
            updateLineNumbers(formattedCode, outputLineNumbersElement);

            // Show success notification after beautification
            showCopyMessage("Kode berhasil dirapikan!", true);
        }

        /**
         * Basic HTML/XML beautifier function.
         * @param {string} code - The HTML/XML code to beautify.
         * @param {number} indentSize - The number of spaces for indentation.
         * @returns {string} The beautified HTML/XML code.
         */
        function beautifyHtml(code, indentSize) {
            let formattedHtml = '';
            let indentLevel = 0;

            // Split HTML/XML by tags, keeping the tags
            const tags = code.replace(/</g, '\n<').replace(/>/g, '>\n').split('\n');

            tags.forEach(tag => {
                tag = tag.trim();
                if (!tag) return;

                // Check for closing tags
                if (tag.startsWith('</')) {
                    indentLevel--;
                    if (indentLevel < 0) indentLevel = 0; // Prevent negative indent
                }

                // Add indentation
                formattedHtml += ' '.repeat(indentLevel * indentSize) + tag + '\n';

                // Check for opening tags (and self-closing tags)
                if (tag.startsWith('<') && !tag.startsWith('</') && !tag.endsWith('/>')) {
                    const tagNameMatch = tag.match(/^<([a-zA-Z0-9]+)/);
                    if (tagNameMatch) {
                        const tagName = tagNameMatch[1].toLowerCase();
                        const selfClosingTags = ['area', 'base', 'br', 'col', 'embed', 'hr', 'img', 'input', 'link', 'meta', 'param', 'source', 'track', 'wbr'];
                        if (!selfClosingTags.includes(tagName)) {
                            indentLevel++;
                        }
                    }
                }
            });
            return formattedHtml;
        }

        /**
         * Basic CSS beautifier function.
         * This is a very simple implementation and might not handle all CSS complexities.
         * @param {string} code - The CSS code to beautify.
         * @param {number} indentSize - The number of spaces for indentation.
         * @returns {string} The beautified CSS code.
         */
        function beautifyCss(code, indentSize) {
            let formattedCss = '';
            let indentLevel = 0;
            const lines = code.split('\n');

            lines.forEach(line => {
                line = line.trim();
                if (!line) return;

                // Decrease indent for closing braces
                if (line.includes('}')) {
                    indentLevel--;
                    if (indentLevel < 0) indentLevel = 0;
                }

                formattedCss += ' '.repeat(indentLevel * indentSize) + line + '\n';

                // Increase indent for opening braces
                if (line.includes('{')) {
                    indentLevel++;
                }
            });
            return formattedCss;
        }

        /**
         * Basic JavaScript beautifier function.
         * This is a very simple implementation and might not handle all JS complexities (e.g., semicolons, complex statements).
         * @param {string} code - The JavaScript code to beautify.
         * @param {number} indentSize - The number of spaces for indentation.
         * @returns {string} The beautified JavaScript code.
         */
        function beautifyJavaScript(code, indentSize) {
            let formattedJs = '';
            let indentLevel = 0;
            const lines = code.split('\n');

            lines.forEach(line => {
                line = line.trim();
                if (!line) return;

                // Decrease indent for closing braces or parentheses
                if (line.includes('}') || line.includes(']')) {
                    indentLevel--;
                    if (indentLevel < 0) indentLevel = 0;
                }

                formattedJs += ' '.repeat(indentLevel * indentSize) + line + '\n';

                // Increase indent for opening braces or parentheses
                if (line.includes('{') || line.includes('[')) {
                    indentLevel++;
                }
            });
            return formattedJs;
        }

        /**
         * Copies the content of the output code element to the clipboard.
         */
        function copyToClipboard() {
            const textToCopy = outputCodeElement.textContent; // Copy from the output element

            if (!textToCopy.trim()) {
                showCopyMessage("Tidak ada kode untuk disalin!", false);
                return;
            }

            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = textToCopy;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            tempTextArea.setSelectionRange(0, 99999);
            try {
                document.execCommand('copy');
                showCopyMessage("Disalin!");
            } catch (err) {
                console.error('Failed to copy text: ', err);
                showCopyMessage("Gagal menyalin!", false);
            }
            document.body.removeChild(tempTextArea);
        }

        /**
         * Shows a temporary message indicating copy status.
         * @param {string} messageText - The message to display.
         * @param {boolean} isSuccess - True if success, false for error/warning.
         */
        function showCopyMessage(messageText, isSuccess = true) {
            copyMessageElement.textContent = messageText;
            copyMessageElement.style.backgroundColor = isSuccess ? 'rgba(0, 128, 0, 0.7)' : 'rgba(255, 0, 0, 0.7)';
            copyMessageElement.classList.add('show');

            setTimeout(() => {
                copyMessageElement.classList.remove('show');
            }, 1500);
        }

        /**
         * Downloads the beautified code as a text file.
         */
        function downloadCode() {
            const codeContent = outputCodeElement.textContent; // Download from the output element
            if (!codeContent.trim()) {
                showCopyMessage("Tidak ada kode untuk diunduh!", false);
                return;
            }

            const language = languageSelect.value;
            let filename = `beautified_code.${language}`;
            if (language === 'html' || language === 'xml') {
                filename = `beautified_code.${language}`;
            } else if (language === 'javascript') {
                filename = 'beautified_code.js';
            } else if (language === 'css') {
                filename = 'beautified_code.css';
            } else if (language === 'php') {
                filename = 'beautified_code.php';
            } else if (language === 'mikrotik') {
                filename = 'beautified_code.rsc';
            } else {
                filename = 'beautified_code.txt';
            }

            const blob = new Blob([codeContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showCopyMessage("Kode diunduh!");
        }

        // Initial setup on load
        document.addEventListener('DOMContentLoaded', () => {
            // Load sample code on initial load if toggle is checked
            if (sampleToggle.checked) {
                inputCode.value = sampleCodes[languageSelect.value] || '';
            }
            beautifyCode(); // Perform initial beautification and highlighting for output
        });
    </script>
</body>
</html>
